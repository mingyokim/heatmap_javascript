<html>
        <head>
                <style>
                        #map {
                                height: 400px;
                                width: 100%;
                        }
                </style>
		<!--<script type="text/javascript" src="js/jquery-csv/src/jquery.csv.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>-->
        <head>
        <body>
                <div id="map"></div>
                <!--<script type="text/javascript" src="http://localhost:8000/js/jquery-csv/src/jquery.csv.js"></script>-->
		<script>
                        function initMap() {
                        	var data;
				
				var newYork = new google.maps.LatLng(40.730610, -73.935242);

				map = new google.maps.Map(document.getElementById('map'), {
					center: newYork,
					zoom: 10,
					//mapTypeId: 'satellite'
				});

				$(document).ready(function() {
					$.ajax({
						type: "GET",
						async: false,
						url: "http://localhost:8000/listings.csv",
						dataType: "text",
						success: function(response) {
							 data=response
						}
					});
				});
				
				var heatMapData = [];
				var objList = $.csv.toObjects(data);
				for(i = 0; i < objList.length; i++) {
					var price = objList[i]['price'];
					if(price>1000) continue;
					var latitude = objList[i]['latitude'];
					var longitude = objList[i]['longitude'];
					
					var obj = {location: new google.maps.LatLng(latitude, longitude), weight: price};
					heatMatData.push(obj);
				}

				var heatmap = new google.maps.visualization.HeatmapLayer({
					data: heatMapData,
					radius: 3,
					maxIntensity: 15
				});
				heatmap.setMap(map);
			}
                </script>
                <script async defer
                        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqCxxQq6OgSX6tQhihd-DfaBkyzR88vU8&callback=initMap&libraries=visualization">
		</script>
		<script type="text/javascript" src="http://localhost:8000/js/jquery-csv/src/jquery.csv.js"></script>
		<script src="http://localhost:8000/js/jquery-3.1.1.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        </body>
</html>
